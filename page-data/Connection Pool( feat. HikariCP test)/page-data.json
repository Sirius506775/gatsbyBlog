{"componentChunkName":"component---src-templates-blog-post-js","path":"/Connection Pool( feat. HikariCP test)/","result":{"data":{"site":{"siteMetadata":{"title":"DoneHeon's Develog"}},"markdownRemark":{"id":"2a49fc33-54a8-565a-8771-ad6e7d5a7b63","excerpt":"대규모의 사용자가 DB연결을 반복하는 플랫폼을 실행하는 경우에는 Database와 connection…","html":"<p>대규모의 사용자가 DB연결을 반복하는 플랫폼을 실행하는 경우에는 Database와 connection을 생성하는 과정 자체가 비용이 많이 들고, 시간이 많이 걸리기 때문에 성능에 영향을 줄 수  있다. 때문에 우리는 성능 향상을 위한 관리가 필요한데 이때 사용할 수 있는 것이 바로 Connection Pool Framework이다.</p>\n<h2>JDBC Connection pooling frameworks</h2>\n<p>기업용으로 사용할 수 있는 여러 Connection Pool Framework가 존재하지만 이것은 어플리케이션에 어떤 프레임워크를 사용해야하는지에 대한 혼란을 만들기도 한다. 어떤 Connection Pool이 서비스에 가장 적합한지 파악하는데 많은 시간을 투자하고 싶지 않다면 가장 추천하는 프레임워크는 HikariCP이다.</p>\n<p>C3P0, Apache DBCP, BoneCp, Vibur 등과 같이 선택할 수 있는 프레임워크가 많이 있지만 가장 인기 있는 선택은 <strong>Tomcat JDBC</strong> 및 <strong>HikariCP이다.</strong></p>\n<p>![[Pasted image 20230103172414.png]]\r\nJMH Microbench results : source <a href=\"https://github.com/brettwooldridge/HikariCP\">HikariCP</a>\r\n위 벤치마크 결과 상으로도 CP 프레임워크 시장에서  HikariCP는 압도적으로 점유하고 있으며, Spring boot 2.0부터는 default JDBC connection pool을 HikariCP로 사용 중이기도 하다.</p>\n<h2>Connection Pool Process</h2>\n<p>![[Pasted image 20230103170933.png]]\r\n커넥션 풀은 정해진 수량의 connection 객체들을 pool에 담아놓고 getConnection() 요청이 들어오면 Thread가 connection을 요청하여 HikariCP가 pool 내에 있는 connection과 연결해준다. 애플리케이션이 시작될 때마다 커넥션 풀이 데이터베이스와 함께 생성된다.</p>\n<p>![[Pasted image 20230103172351.png]]</p>\n<p>Connection pool은 connection 객체를 pool 내에서 미리 준비하여 연결을 유지하고 몇 번이고 재사용할 수 있게함으로써 어플리케이션의 성능 저하를 막을 수 있다.</p>\n<h3>Dependency</h3>\n<p>Spring에서 <a href=\"https://mvnrepository.com/artifact/com.zaxxer/HikariCP\">HikariCP</a> 사용 시에는 dependencies에 종속성 추가를 해야한다.\r\ngradle 설정 시 예시는는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// https://mvnrepository.com/artifact/com.zaxxer/HikariCP</span>\r\nimplementation group<span class=\"token operator\">:</span> 'com<span class=\"token punctuation\">.</span>zaxxer'<span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> '<span class=\"token class-name\">HikariCP</span>'<span class=\"token punctuation\">,</span> version<span class=\"token operator\">:</span> <span class=\"token char\">'5.0.1'</span>\r\n</code></pre></div>\n<h2>TestCode</h2>\n<p>Spring에서 jdbc 드라이버와 HikariCP 종속성을 추가했다면, 올바른 작동 확인을 위한 테스트를 진행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>  \r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testHikariCP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span> \r\n<span class=\"token comment\">//Connection 생성을 위한 HikariCP 테스트  </span>\r\n  \r\n    <span class=\"token class-name\">HikariConfig</span> config <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HikariConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \r\n    <span class=\"token comment\">//HikariConfig 타입의 객체를 생성한다.(CP를 생성하는데 필요한 정보를 가지고 있음)  </span>\r\n    config<span class=\"token punctuation\">.</span><span class=\"token function\">setDriverClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"org.mariadb.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n    config<span class=\"token punctuation\">.</span><span class=\"token function\">setJdbcUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jdbc:mariadb://localhost:3306/testdb\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n    config<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testUser\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n    config<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1111\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n    config<span class=\"token punctuation\">.</span><span class=\"token function\">addDataSourceProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cachePrepStmts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n    config<span class=\"token punctuation\">.</span><span class=\"token function\">addDataSourceProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prepStmtCacheSize\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"250\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n    config<span class=\"token punctuation\">.</span><span class=\"token function\">addDataSourceProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prepStmtCacheSqlLimit\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2048\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n  \r\n    <span class=\"token class-name\">HikariDataSource</span> ds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HikariDataSource</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \r\n    <span class=\"token comment\">//HikariDataSource 객체를 생성해서  </span>\r\n    <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> ds<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \r\n    <span class=\"token comment\">// getConnection()으로 Connection 객체를 얻어서 사용한다.  </span>\r\n  \r\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n  \r\n    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n\t<span class=\"token comment\">//JDBC 프로그래밍에서 가장 중요한 것은 Connection은 반드시 close() 해야한다.</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트 코드를 실행하면 출력 결과에서 HikariCP를 통해 얻어온 Connection을 확인할 수 있다.</p>\n<p>![[Pasted image 20230103165220.png]]</p>\n<blockquote>\n<p>@ 뒤의 값은 다를 수 있다.</p>\n</blockquote>\n<p>참고문헌</p>\n<ul>\n<li><a href=\"https://medium.com/javarevisited/choosing-the-right-jdbc-connection-pool-c9ef90588d55\">https://medium.com/javarevisited/choosing-the-right-jdbc-connection-pool-c9ef90588d55</a></li>\n<li><a href=\"https://book.interpark.com/product/BookDisplay.do?_method=detail&#x26;sc.prdNo=355020973&#x26;gclid=CjwKCAiAwc-dBhA7EiwAxPRylBVoaskxg2RSgHN2w9Hqqi8gA8RiQypg2QoQHG4JsreiQURisLSpoBoCZM8QAvD_BwE\">https://book.interpark.com/product/BookDisplay.do?_method=detail&#x26;sc.prdNo=355020973&#x26;gclid=CjwKCAiAwc-dBhA7EiwAxPRylBVoaskxg2RSgHN2w9Hqqi8gA8RiQypg2QoQHG4JsreiQURisLSpoBoCZM8QAvD_BwE</a></li>\n</ul>","frontmatter":{"title":"Connection Pool( feat. HikariCP test)","date":"January 04, 2023","description":"Connection pool은 connection 객체를 pool 내에서 미리 준비하여 연결을 유지하고 몇 번이고 재사용할 수 있게함으로써 어플리케이션의 성능 저하를 막을 수 있다."}},"previous":{"fields":{"slug":"/Pure Function(순수 함수)/"},"frontmatter":{"title":"Pure Function"}},"next":null},"pageContext":{"id":"2a49fc33-54a8-565a-8771-ad6e7d5a7b63","previousPostId":"8312e7ab-a7af-542f-9d47-33a80654c124","nextPostId":null}},"staticQueryHashes":["3257411868","3589320610"],"slicesMap":{}}