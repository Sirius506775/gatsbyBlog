{"componentChunkName":"component---src-templates-blog-post-js","path":"/spring/Connection Pool( feat. HikariCP test)/","result":{"data":{"site":{"siteMetadata":{"title":"DoneHeon's Develog"}},"markdownRemark":{"id":"e5c3b5ee-e8cf-5dfd-8e03-4f8024d6313c","excerpt":"Connection Pool( feat. HikariCP test) 대규모의 사용자가 DB연결을 반복하는 플랫폼을 실행하는 경우에는 Database와 connection…","html":"<h1>Connection Pool( feat. HikariCP test)</h1>\n<p>대규모의 사용자가 DB연결을 반복하는 플랫폼을 실행하는 경우에는 Database와 connection을 생성하는 과정 자체가 비용이 많이 들고, 시간이 많이 걸리기 때문에 성능에 영향을 줄 수  있다. 때문에 우리는 성능 향상을 위한 관리가 필요한데 이때 사용할 수 있는 것이 바로 Connection Pool Framework이다.</p>\n<h2>JDBC Connection pooling frameworks</h2>\n<p>기업용으로 사용할 수 있는 여러 Connection Pool Framework가 존재하지만 이것은 어플리케이션에 어떤 프레임워크를 사용해야하는지에 대한 혼란을 만들기도 한다. 어떤 Connection Pool이 서비스에 가장 적합한지 파악하는데 많은 시간을 투자하고 싶지 않다면 가장 추천하는 프레임워크는 HikariCP이다.</p>\n<p>C3P0, Apache DBCP, BoneCp, Vibur 등과 같이 선택할 수 있는 프레임워크가 많이 있지만 가장 인기 있는 선택은 <strong>Tomcat JDBC</strong> 및 <strong>HikariCP이다.</strong></p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/958d839500e6818be257f9816795ebae/9cab2/2023-cp01.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABcUlEQVQY01WQ2y8DQRTG99/CAwlKQvZB3YkHvHjx5A/QxCUuiQciXRKRiGtE0MYLiVQbEm1cmoZGEGlY2rI7M1ut6pw5Mrs0+uVk5uSb/L4zOQoHnkwndV2nlDLGCCGMMSEE2iKEGIZBKSWEmKaZy+UcXyAColLgBcpoNpt1AAcqcPBFDg5v96TzF2RDAgCAc13TEjMzSvENwPE5IhqMlg/XzwZHZBBwEOK3AORMzuNdnTFVVZws6doCAEQ0Lcs17l44nUZEDlz8E//+/spYsd7+q5Y2BUpVnFwz2uQNTTqw9OXJBaIeCdz618LNLecNqgICnP8UG7mnjOUadWuhKQlz/rsJ+3oOHkQ3vMFGNVBbp2CpAIBZLPH2XOlpnAuM2YT4yufSZurTerc+XhIn/uiGd7+qeresQnlJvqaNVOzh5lF/iD/FL+4jnq2J1bOlvvnB9fAiIjKaP4r6Bpbbj7eHrjX33eHm5c7KXnfPbmvHDy2GoSo+CVnjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result query\" title=\"result query\" src=\"/static/958d839500e6818be257f9816795ebae/f058b/2023-cp01.png\" srcset=\"/static/958d839500e6818be257f9816795ebae/c26ae/2023-cp01.png 158w,\n/static/958d839500e6818be257f9816795ebae/6bdcf/2023-cp01.png 315w,\n/static/958d839500e6818be257f9816795ebae/f058b/2023-cp01.png 630w,\n/static/958d839500e6818be257f9816795ebae/9cab2/2023-cp01.png 864w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>JMH Microbench results : source <a href=\"https://github.com/brettwooldridge/HikariCP\">HikariCP</a>\n위 벤치마크 결과 상으로도 CP 프레임워크 시장에서  HikariCP는 압도적으로 점유하고 있으며, Spring boot 2.0부터는 default JDBC connection pool을 HikariCP로 사용 중이기도 하다.</p>\n<h2>Connection Pool Process</h2>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/5784c6fec194eb379a2cd179c275a423/c8e86/2023-cp02.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 30.37974683544304%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHUlEQVQY03XLO04DMRSF4SmR2EKWg9hA9kTHDpAoWAGihCoKokGRKFKQRMq8PLE9M37czNi+Ez9QUBoKvuKvzsnSrxCCGU36Sw86J3l5KMumOJrjZRkjZcxam1LKRhyVVWKUFa/AgbRKajXh5JPnmoMGLTXYQTipDYzWIQDUxLbcg86UkZRTRhmllLedYlWzWbf7PA7DqlrNn+Y3D7cfny/hQMluzb83w26HnDveIuPns51s3/c1qSfvJa00KchmO0n1ni9n97Oru+vn5WOqWU/2UQhsGlYU5XZruy4zJyOsAASYQDstjPDRO+sMmkY1i/Xi9euNd8SAVIonH5BSrOtz6SFL//DRCyNP/hSCHyfTW4keU0oxhoAYEWMIP2cSSn/sDwbmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result query\" title=\"result query\" src=\"/static/5784c6fec194eb379a2cd179c275a423/f058b/2023-cp02.png\" srcset=\"/static/5784c6fec194eb379a2cd179c275a423/c26ae/2023-cp02.png 158w,\n/static/5784c6fec194eb379a2cd179c275a423/6bdcf/2023-cp02.png 315w,\n/static/5784c6fec194eb379a2cd179c275a423/f058b/2023-cp02.png 630w,\n/static/5784c6fec194eb379a2cd179c275a423/c8e86/2023-cp02.png 758w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>커넥션 풀은 정해진 수량의 connection 객체들을 pool에 담아놓고 getConnection() 요청이 들어오면 Thread가 connection을 요청하여 HikariCP가 pool 내에 있는 connection과 연결해준다. 애플리케이션이 시작될 때마다 커넥션 풀이 데이터베이스와 함께 생성된다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/a2ea151c10bc4f03a801af93eea588da/0b533/2023-cp03.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 73.41772151898735%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACp0lEQVQozz2Sy3KqWhRF+f+vSHo0Ul61mSqVikoMCkFwP3hswM0BeUc0hKDgvnXg1h3dNRpzrrW4pCeO4zAMgyCI4/jr66soijzPD4eD7/tRFKVpGgTBIAyj8/kMAOD2+/1e3QdBYFlWEAS3261t2/v93rYtRvj9/X273TqOQyklhFwul67rmqZhjBFCONd1HcexLAtCqGnaerWWJAljLIqipmkYY9M0CSEAAF3TZVleLpcY481m8/b2xqmqKooiOIDVajWbzXieN03T933TNHVdl3r2+72iKIv5YjKeiKJ4Op0Mw/j4+OAul0tVVUVRWJa1XC4XiwUhJAxD27YhhEoPIUTTNFEUBUHQNC2KItd1ZVnmWM+tuSVJUpYlY+zn5+f7+/v39xchtOuhlGZZluf54/FomqaqqtvtZts25/s+7DEMwzRNjDFCCEH0x/9DCIEQggOwbduyLF3XAQCDZhgGxpjzPM9xHNd1jz2e5xFCnB7DMNyeYdvD1HGcQUAI/Y39eDzKskySJMuyuq6HIm3b2rbdti1jrK7rLMvSND2fz4PPGHNd97/ORVHouk6PNE1Tz/OiKLIsyzTNrusYY/f7fUibpiml9HQ6HY9HVVU5BJGqqpRSx3Hmi/nLy4ssywCA3W43XEiRFYRQGIabzWY6nQqCgDGWJGm9XnMY4QM42LY9n895nn9+fsYYD50BABBChJBpmgCA8T/jp6en9XpNKbVt+/Pzk4MQ6ro+2EEQ5HmeZVlRFGEYWpb1f+woinzfHw6W53mSJH9/m1IKIbxer8PCvnuapum6zvO8ruvqui7LMsuyOI7P5fl6vVZVxRg7Ho+cYRjb7fb19XU0Go3H48lkslqtZFmGEMqyrOu6oiiCIIxGo+l0yvP8bDbb7XYAAEmS/gXgDgqPScJGZgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result query\" title=\"result query\" src=\"/static/a2ea151c10bc4f03a801af93eea588da/0b533/2023-cp03.png\" srcset=\"/static/a2ea151c10bc4f03a801af93eea588da/c26ae/2023-cp03.png 158w,\n/static/a2ea151c10bc4f03a801af93eea588da/6bdcf/2023-cp03.png 315w,\n/static/a2ea151c10bc4f03a801af93eea588da/0b533/2023-cp03.png 500w\" sizes=\"(max-width: 500px) 100vw, 500px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<p>Connection pool은 connection 객체를 pool 내에서 미리 준비하여 연결을 유지하고 몇 번이고 재사용할 수 있게함으로써 어플리케이션의 성능 저하를 막을 수 있다.</p>\n<h3>Dependency</h3>\n<p>Spring에서 <a href=\"https://mvnrepository.com/artifact/com.zaxxer/HikariCP\">HikariCP</a> 사용 시에는 dependencies에 종속성 추가를 해야한다.\ngradle 설정 시 예시는는 아래와 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// https://mvnrepository.com/artifact/com.zaxxer/HikariCP</span>\nimplementation group<span class=\"token operator\">:</span> 'com<span class=\"token punctuation\">.</span>zaxxer'<span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> '<span class=\"token class-name\">HikariCP</span>'<span class=\"token punctuation\">,</span> version<span class=\"token operator\">:</span> <span class=\"token char\">'5.0.1'</span>\n</code></pre></div>\n<h2>TestCode</h2>\n<p>Spring에서 jdbc 드라이버와 HikariCP 종속성을 추가했다면, 올바른 작동 확인을 위한 테스트를 진행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">testHikariCP</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span> \n<span class=\"token comment\">//Connection 생성을 위한 HikariCP 테스트  </span>\n  \n    <span class=\"token class-name\">HikariConfig</span> config <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HikariConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token comment\">//HikariConfig 타입의 객체를 생성한다.(CP를 생성하는데 필요한 정보를 가지고 있음)  </span>\n    config<span class=\"token punctuation\">.</span><span class=\"token function\">setDriverClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"org.mariadb.jdbc.Driver\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    config<span class=\"token punctuation\">.</span><span class=\"token function\">setJdbcUrl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jdbc:mariadb://localhost:3306/testdb\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    config<span class=\"token punctuation\">.</span><span class=\"token function\">setUsername</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"testUser\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    config<span class=\"token punctuation\">.</span><span class=\"token function\">setPassword</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1111\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    config<span class=\"token punctuation\">.</span><span class=\"token function\">addDataSourceProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cachePrepStmts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"true\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    config<span class=\"token punctuation\">.</span><span class=\"token function\">addDataSourceProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prepStmtCacheSize\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"250\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    config<span class=\"token punctuation\">.</span><span class=\"token function\">addDataSourceProperty</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prepStmtCacheSqlLimit\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2048\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token class-name\">HikariDataSource</span> ds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HikariDataSource</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token comment\">//HikariDataSource 객체를 생성해서  </span>\n    <span class=\"token class-name\">Connection</span> connection <span class=\"token operator\">=</span> ds<span class=\"token punctuation\">.</span><span class=\"token function\">getConnection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token comment\">// getConnection()으로 Connection 객체를 얻어서 사용한다.  </span>\n  \n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n    connection<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\t<span class=\"token comment\">//JDBC 프로그래밍에서 가장 중요한 것은 Connection은 반드시 close() 해야한다.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트 코드를 실행하면 출력 결과에서 HikariCP를 통해 얻어온 Connection을 확인할 수 있다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/bcd043ea4e3dc380ac728e5deb482987/25260/2023-cp04.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 10.126582278481013%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABnWAAAZ1gEY0crtAAAAXklEQVQI11WMXQoAIQiE9zgFQVSa2c/9jzWLQgv7MOh8OvPsvTHnxFoL5xyoqu8iAmYGEWGIoLUGYnbee/9k/mbs57nGim0OVT9YWa0VOWfUUjycUkIIATHGn4xd/gKTZ0Aw9EeGugAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"result query\" title=\"result query\" src=\"/static/bcd043ea4e3dc380ac728e5deb482987/f058b/2023-cp04.png\" srcset=\"/static/bcd043ea4e3dc380ac728e5deb482987/c26ae/2023-cp04.png 158w,\n/static/bcd043ea4e3dc380ac728e5deb482987/6bdcf/2023-cp04.png 315w,\n/static/bcd043ea4e3dc380ac728e5deb482987/f058b/2023-cp04.png 630w,\n/static/bcd043ea4e3dc380ac728e5deb482987/40601/2023-cp04.png 945w,\n/static/bcd043ea4e3dc380ac728e5deb482987/25260/2023-cp04.png 1113w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<blockquote>\n<p>@ 뒤의 값은 다를 수 있다.</p>\n</blockquote>\n<p>참고문헌</p>\n<ul>\n<li><a href=\"https://medium.com/javarevisited/choosing-the-right-jdbc-connection-pool-c9ef90588d55\">https://medium.com/javarevisited/choosing-the-right-jdbc-connection-pool-c9ef90588d55</a></li>\n<li><a href=\"https://book.interpark.com/product/BookDisplay.do?_method=detail&#x26;sc.prdNo=355020973&#x26;gclid=CjwKCAiAwc-dBhA7EiwAxPRylBVoaskxg2RSgHN2w9Hqqi8gA8RiQypg2QoQHG4JsreiQURisLSpoBoCZM8QAvD_BwE\">https://book.interpark.com/product/BookDisplay.do?_method=detail&#x26;sc.prdNo=355020973&#x26;gclid=CjwKCAiAwc-dBhA7EiwAxPRylBVoaskxg2RSgHN2w9Hqqi8gA8RiQypg2QoQHG4JsreiQURisLSpoBoCZM8QAvD_BwE</a></li>\n</ul>","frontmatter":{"title":"Connection Pool( feat. HikariCP test)","date":"January 04, 2023","description":"대규모의 사용자가 DB연결을 반복하는 플랫폼을 실행하는 경우에는 Database와 connection을 생성하는 과정 자체가 비용이 많이 들고, 시간이 많이 걸리기 때문에 성능에 영향을 줄 수  있다. 때문에 우리는 성능 향상을 위한 관리가 필요한데 이때 사용할 수 있는 것이 바로 Connection Pool Framework이다."}},"previous":{"fields":{"slug":"/Connection Pool( feat. HikariCP test)/"},"frontmatter":{"title":"Connection Pool( feat. HikariCP test)"}},"next":{"fields":{"slug":"/error message/2023-vscode-1/"},"frontmatter":{"title":"VScode 사용 중 스크립트 실행 불가에러 PSSecurityException 보안 오류 해결 방법"}}},"pageContext":{"id":"e5c3b5ee-e8cf-5dfd-8e03-4f8024d6313c","previousPostId":"2a49fc33-54a8-565a-8771-ad6e7d5a7b63","nextPostId":"26baa4a1-b69e-583b-90ee-8b061caf97b1"}},"staticQueryHashes":["3257411868","3589320610"],"slicesMap":{}}